---
import '../styles/global.css';
import { ClientRouter } from 'astro:transitions';

interface Props { title: string; }
const { title } = Astro.props;
const { pathname: rawPath } = Astro.url;
const pathname = rawPath.replace(/\/$/, "") || "/";

// i18n Logik
const currentLang = Astro.currentLocale || 'en';
const isGerman = currentLang === 'de';

const targetLang = isGerman ? 'en' : 'de';
const targetHref = isGerman 
  ? (pathname.replace(/^\/de/, '') || '/') 
  : `/de${pathname === '/' ? '' : pathname}`;

// Hilfsfunktion fÃ¼r lokalisierte Links
const l = (path: string) => isGerman ? `/de${path === "/" ? "" : path}` : path;

const activeClass = "text-[#00b0f0] font-bold";
const inactiveClass = "text-slate-600 dark:text-slate-400 hover:text-[#00b0f0] transition-colors";
---

<!doctype html>
<html lang={currentLang}>
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<link rel="icon" type="image/png" href="/favicon.png" />
		<title>{title}</title>
		
		<script is:inline>
			if (window.location.pathname === '/' && !localStorage.getItem('preferred-lang')) {
				const browserLang = navigator.language || navigator.userLanguage;
				if (browserLang.startsWith('de')) {
					window.location.pathname = '/de';
				}
			}
		</script>

		<ClientRouter />
		<script is:inline>
			const setVeloxTheme = () => {
				const theme = localStorage.getItem('theme') || (window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light');
				document.documentElement.classList.toggle('dark', theme === 'dark');
			};
			setVeloxTheme();
			document.addEventListener('astro:after-swap', setVeloxTheme);
		</script>
	</head>
	<body class="bg-white dark:bg-[#0b0f1a] text-slate-900 dark:text-slate-100 transition-colors duration-300 min-h-screen relative flex flex-col">
		<div class="relative z-10 flex flex-col min-h-screen w-full">
			<nav id="mainNav" class="fixed top-0 left-0 w-full z-50 transition-all duration-300 border-b border-transparent">
				<div class="max-w-6xl mx-auto px-6 h-20 flex items-center justify-between">
					<a href={l("/")} class="hover:opacity-80 transition flex-shrink-0">
						<img src="/logo_wText.webp" alt="Veloxos Logo" class="h-8 w-auto" />
					</a>
					
					<div class="hidden lg:flex items-center gap-6 text-sm font-medium">
						<a href={l("/")} class={pathname === l("/") ? activeClass : inactiveClass}>VeloxOS</a>
						<a href={l("/about")} class={pathname === l("/about") ? activeClass : inactiveClass}>About</a>
						<a href={l("/roadmap")} class={pathname === l("/roadmap") ? activeClass : inactiveClass}>Roadmap</a>
						<a href={l("/features")} class={pathname === l("/features") ? activeClass : inactiveClass}>Features</a>
						<a href="https://packages.veloxos.org" target="_blank" class="text-slate-600 dark:text-slate-400 hover:text-[#00b0f0] transition">Packages</a>
						<a href="https://wiki.veloxos.org" target="_blank" class="text-slate-600 dark:text-slate-400 hover:text-[#00b0f0] transition">Wiki</a>
						
						<div class="flex items-center gap-3 border-l border-slate-200 dark:border-white/10 pl-4">
							<div class="flex items-center ml-2 mr-1">
								<a href={targetHref} 
								   onclick={`localStorage.setItem('preferred-lang', '${targetLang}')`}
								   class="text-[10px] font-bold px-2 py-1 rounded border border-slate-200 dark:border-white/10 hover:border-[#00b0f0] transition-colors text-slate-500 hover:text-[#00b0f0]">
									{isGerman ? 'EN' : 'DE'}
								</a>
							</div>
							</div>
					</div>
					</div>
				</nav>

			<main class="flex-grow pt-16" transition:animate="fade">
				<slot />
			</main>

			</div>
	</body>
</html>
